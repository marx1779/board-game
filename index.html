<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5ì´ˆì¤€ë‹¤! - ë³´ë“œê²Œì„</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #333;
  }

  .container {
    width: 100%;
    max-width: 600px;
    padding: 20px;
  }

  .screen { display: none; }
  .screen.active { display: block; }

  /* ===== ì‹œì‘ í™”ë©´ ===== */
  .title {
    text-align: center;
    color: #fff;
    margin-bottom: 30px;
  }
  .title h1 {
    font-size: 3.5rem;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
    animation: bounce 2s infinite;
  }
  .title p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin-top: 8px;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .card {
    background: #fff;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  }

  .card h2 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 1.3rem;
    color: #555;
  }

  .player-input-row {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }

  .player-input-row input {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .player-input-row input:focus {
    border-color: #667eea;
  }

  .btn {
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
  .btn:active { transform: translateY(0); }

  .btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #fff;
  }
  .btn-success {
    background: linear-gradient(135deg, #11998e, #38ef7d);
    color: #fff;
  }
  .btn-danger {
    background: linear-gradient(135deg, #eb3349, #f45c43);
    color: #fff;
  }
  .btn-warning {
    background: linear-gradient(135deg, #f7971e, #ffd200);
    color: #fff;
  }
  .btn-add {
    background: #667eea;
    color: #fff;
    min-width: 48px;
    font-size: 1.4rem;
    padding: 12px;
  }

  .player-list {
    list-style: none;
    margin-bottom: 20px;
  }
  .player-list li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 8px;
    font-size: 1rem;
    font-weight: 600;
  }
  .player-list li .player-color {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 10px;
  }
  .player-list li button {
    background: none;
    border: none;
    color: #e74c3c;
    font-size: 1.2rem;
    cursor: pointer;
  }

  .btn-start {
    width: 100%;
    padding: 16px;
    font-size: 1.3rem;
  }

  /* ===== ê²Œì„ í™”ë©´ ===== */
  .game-header {
    text-align: center;
    color: #fff;
    margin-bottom: 20px;
  }
  .game-header .turn-info {
    font-size: 1.1rem;
    opacity: 0.9;
  }
  .game-header .player-name {
    font-size: 2rem;
    font-weight: 800;
    margin-top: 4px;
  }

  .question-card {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    margin-bottom: 24px;
    min-height: 160px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    position: relative;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .question-card:hover { transform: scale(1.02); }

  .question-card .card-label {
    font-size: 0.9rem;
    color: #e17055;
    font-weight: 700;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  .question-card .question-text {
    font-size: 1.6rem;
    font-weight: 800;
    color: #2d3436;
    line-height: 1.4;
  }
  .question-card .card-back {
    font-size: 3rem;
  }

  /* íƒ€ì´ë¨¸ */
  .timer-section {
    text-align: center;
    margin-bottom: 24px;
  }

  .timer-circle {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 0 auto 20px;
  }
  .timer-circle svg {
    width: 180px;
    height: 180px;
    transform: rotate(-90deg);
  }
  .timer-circle .bg {
    fill: none;
    stroke: #e0e0e0;
    stroke-width: 10;
  }
  .timer-circle .progress {
    fill: none;
    stroke: #38ef7d;
    stroke-width: 10;
    stroke-linecap: round;
    stroke-dasharray: 502;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 0.1s linear, stroke 0.3s;
  }
  .timer-circle .timer-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 4rem;
    font-weight: 900;
    color: #333;
  }

  .timer-circle.warning .progress { stroke: #f7971e; }
  .timer-circle.danger .progress { stroke: #eb3349; }
  .timer-circle.danger .timer-text { color: #eb3349; animation: pulse 0.5s infinite; }

  @keyframes pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.15); }
  }

  .timer-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
  }
  .timer-buttons .btn { min-width: 140px; font-size: 1.1rem; padding: 14px 24px; }

  /* íŒì • */
  .judge-section {
    text-align: center;
  }
  .judge-section h3 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: #555;
  }
  .judge-buttons {
    display: flex;
    gap: 16px;
    justify-content: center;
  }
  .judge-buttons .btn {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    font-size: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ì ìˆ˜íŒ */
  .scoreboard {
    margin-top: 20px;
  }
  .scoreboard h3 {
    text-align: center;
    color: #fff;
    margin-bottom: 12px;
    font-size: 1.1rem;
  }
  .score-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
  }
  .score-item {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 10px 18px;
    text-align: center;
    color: #fff;
    min-width: 80px;
    transition: transform 0.3s;
  }
  .score-item.current {
    background: rgba(255,255,255,0.4);
    transform: scale(1.1);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .score-item .score-name {
    font-size: 0.85rem;
    opacity: 0.9;
  }
  .score-item .score-value {
    font-size: 1.8rem;
    font-weight: 900;
  }

  /* ìŠ¹ë¦¬ í™”ë©´ */
  .winner-screen {
    text-align: center;
    color: #fff;
  }
  .winner-screen .trophy { font-size: 6rem; margin-bottom: 20px; }
  .winner-screen h1 { font-size: 2.5rem; margin-bottom: 10px; }
  .winner-screen .winner-name { font-size: 3rem; font-weight: 900; color: #ffd200; }
  .winner-screen .btn { margin-top: 30px; }

  .confetti-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1000;
  }
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    top: -10px;
    animation: confetti-fall linear forwards;
  }
  @keyframes confetti-fall {
    to { top: 110vh; transform: rotate(720deg); }
  }

  /* ì„¤ì • */
  .settings-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    padding: 8px 0;
  }
  .settings-row label { font-weight: 600; color: #555; }
  .settings-row select, .settings-row input[type="number"] {
    padding: 8px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    width: 80px;
    text-align: center;
  }

  /* íƒ€ì„ì•„ì›ƒ ì˜¤ë²„ë ˆì´ */
  .timeout-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(235, 51, 73, 0.85);
    z-index: 500;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: #fff;
    animation: fadeIn 0.3s;
  }
  .timeout-overlay.show { display: flex; }
  .timeout-overlay .timeout-text {
    font-size: 3rem;
    font-weight: 900;
    margin-bottom: 20px;
    animation: shake 0.5s;
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-20px); }
    75% { transform: translateX(20px); }
  }
  @keyframes fadeIn {
    from { opacity: 0; } to { opacity: 1; }
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 480px) {
    .title h1 { font-size: 2.5rem; }
    .card { padding: 20px; }
    .question-card .question-text { font-size: 1.3rem; }
    .timer-circle { width: 150px; height: 150px; }
    .timer-circle svg { width: 150px; height: 150px; }
    .timer-circle .timer-text { font-size: 3rem; }
    .judge-buttons .btn { width: 100px; height: 100px; font-size: 2.5rem; }
  }
</style>
</head>
<body>

<div class="container">
  <!-- ===== ì‹œì‘ í™”ë©´ ===== -->
  <div id="setup-screen" class="screen active">
    <div class="title">
      <h1>5ì´ˆì¤€ë‹¤!</h1>
      <p>5ì´ˆ ì•ˆì— 3ê°€ì§€ë¥¼ ëŒ€ë‹µí•˜ë¼!</p>
    </div>
    <div class="card">
      <h2>í”Œë ˆì´ì–´ ë“±ë¡</h2>
      <div class="player-input-row">
        <input type="text" id="player-name-input" placeholder="í”Œë ˆì´ì–´ ì´ë¦„" maxlength="10">
        <button class="btn btn-add" id="add-player-btn">+</button>
      </div>
      <ul class="player-list" id="player-list"></ul>

      <div class="settings-row">
        <label>ëª©í‘œ ì ìˆ˜</label>
        <input type="number" id="target-score" value="5" min="1" max="20">
      </div>

      <button class="btn btn-primary btn-start" id="start-btn" disabled>
        ê²Œì„ ì‹œì‘ (ìµœì†Œ 2ëª…)
      </button>
    </div>
  </div>

  <!-- ===== ê²Œì„ í™”ë©´ ===== -->
  <div id="game-screen" class="screen">
    <div class="game-header">
      <div class="turn-info" id="turn-info"></div>
      <div class="player-name" id="current-player-name"></div>
    </div>

    <!-- ì§ˆë¬¸ ì¹´ë“œ -->
    <div class="question-card" id="question-card">
      <div class="card-back" id="card-back">ğŸƒ ì¹´ë“œë¥¼ í„°ì¹˜í•˜ì„¸ìš”</div>
      <div id="card-front" style="display:none">
        <div class="card-label">5ì´ˆ ì•ˆì— 3ê°€ì§€!</div>
        <div class="question-text" id="question-text"></div>
      </div>
    </div>

    <!-- íƒ€ì´ë¨¸ -->
    <div class="card">
      <div class="timer-section" id="timer-section">
        <div class="timer-circle" id="timer-circle">
          <svg viewBox="0 0 180 180">
            <circle class="bg" cx="90" cy="90" r="80"/>
            <circle class="progress" id="timer-progress" cx="90" cy="90" r="80"/>
          </svg>
          <div class="timer-text" id="timer-text">5</div>
        </div>
        <div class="timer-buttons"></div>
      </div>

      <!-- íŒì • -->
      <div class="judge-section" id="judge-section" style="display:none">
        <h3>ì„±ê³µí–ˆë‚˜ìš”?</h3>
        <div class="judge-buttons">
          <button class="btn btn-success" id="judge-success">â­•</button>
          <button class="btn btn-danger" id="judge-fail">âŒ</button>
        </div>
      </div>
    </div>

    <!-- ì ìˆ˜íŒ -->
    <div class="scoreboard">
      <h3>ğŸ“Š ì ìˆ˜íŒ</h3>
      <div class="score-list" id="score-list"></div>
    </div>
  </div>

  <!-- ===== ìŠ¹ë¦¬ í™”ë©´ ===== -->
  <div id="winner-screen" class="screen winner-screen">
    <div class="trophy">ğŸ†</div>
    <h1>ì¶•í•˜í•©ë‹ˆë‹¤!</h1>
    <div class="winner-name" id="winner-name"></div>
    <p style="margin-top:10px; font-size:1.2rem;">ìš°ìŠ¹!</p>
    <button class="btn btn-primary" id="restart-btn" style="margin-top:30px; font-size:1.2rem; padding:16px 40px;">
      ë‹¤ì‹œ í•˜ê¸°
    </button>
  </div>
</div>

<!-- íƒ€ì„ì•„ì›ƒ ì˜¤ë²„ë ˆì´ -->
<div class="timeout-overlay" id="timeout-overlay">
  <div class="timeout-text">â° ì‹œê°„ ì´ˆê³¼!</div>
  <button class="btn btn-warning" id="timeout-ok-btn" style="font-size:1.2rem; padding:14px 40px;">í™•ì¸</button>
</div>

<!-- ì½˜í˜í‹° ì»¨í…Œì´ë„ˆ -->
<div class="confetti-container" id="confetti-container"></div>

<script>
// ===== ì§ˆë¬¸ ë°ì´í„° =====
const QUESTIONS = [
  "í•œêµ­ ìŒì‹ 3ê°€ì§€",
  "ë¹¨ê°„ìƒ‰ ê³¼ì¼ 3ê°€ì§€",
  "ë‹¤ë¦¬ê°€ 4ê°œì¸ ë™ë¬¼ 3ê°€ì§€",
  "ì„œìš¸ì— ìˆëŠ” ì§€í•˜ì² ì—­ 3ê°€ì§€",
  "íƒ„ì‚°ìŒë£Œ ë¸Œëœë“œ 3ê°€ì§€",
  "í•œêµ­ ë“œë¼ë§ˆ 3ê°€ì§€",
  "í”¼ì í† í•‘ 3ê°€ì§€",
  "ì—¬ë¦„ì— í•˜ëŠ” í™œë™ 3ê°€ì§€",
  "ê²¨ìš¸ì— ë¨¹ëŠ” ìŒì‹ 3ê°€ì§€",
  "í•™êµì—ì„œ ë°°ìš°ëŠ” ê³¼ëª© 3ê°€ì§€",
  "ìŠˆí¼íˆì–´ë¡œ 3ê°€ì§€",
  "ì•…ê¸° 3ê°€ì§€",
  "í•œêµ­ ì•„ì´ëŒ ê·¸ë£¹ 3ê°€ì§€",
  "ë…¸ë€ìƒ‰ì¸ ê²ƒ 3ê°€ì§€",
  "ë°”ë‹¤ì— ì‚¬ëŠ” ìƒë¬¼ 3ê°€ì§€",
  "ìš´ë™ ì¢…ëª© 3ê°€ì§€",
  "ë‚˜ë¼ ìˆ˜ë„ 3ê°€ì§€",
  "ì»¤í”¼ ì¢…ë¥˜ 3ê°€ì§€",
  "ìŠ¤ë§ˆíŠ¸í° ë¸Œëœë“œ 3ê°€ì§€",
  "ê³µì´ í•„ìš”í•œ ìŠ¤í¬ì¸  3ê°€ì§€",
  "ì•„ì¹¨ì— í•˜ëŠ” ì¼ 3ê°€ì§€",
  "ëƒ‰ì¥ê³ ì— ìˆëŠ” ê²ƒ 3ê°€ì§€",
  "ìƒì¼ì— í•˜ëŠ” ê²ƒ 3ê°€ì§€",
  "ë™ê·¸ë€ ê²ƒ 3ê°€ì§€",
  "í•œêµ­ ì˜í™” 3ê°€ì§€",
  "ë‹¬ì½¤í•œ ìŒì‹ 3ê°€ì§€",
  "í¸ì˜ì ì—ì„œ íŒŒëŠ” ê²ƒ 3ê°€ì§€",
  "ê³µí¬ ì˜í™”ì— ë‚˜ì˜¤ëŠ” ê²ƒ 3ê°€ì§€",
  "ì—¬í–‰ ê°ˆ ë•Œ ì±™ê¸°ëŠ” ê²ƒ 3ê°€ì§€",
  "ì´ˆë“±í•™ìƒ ë•Œ í•˜ëŠ” ë†€ì´ 3ê°€ì§€",
  "ìœ íŠœë¸Œì—ì„œ ì¸ê¸° ìˆëŠ” ì¥ë¥´ 3ê°€ì§€",
  "ì§ì—… 3ê°€ì§€",
  "ì•„ì‹œì•„ ë‚˜ë¼ 3ê°€ì§€",
  "ìœ ëŸ½ ë‚˜ë¼ 3ê°€ì§€",
  "ë¼ë©´ ë¸Œëœë“œ 3ê°€ì§€",
  "ê³¼ì ì´ë¦„ 3ê°€ì§€",
  "ë§Œí™” ìºë¦­í„° 3ê°€ì§€",
  "ë””ì¦ˆë‹ˆ ì˜í™” 3ê°€ì§€",
  "ì±„ì†Œ 3ê°€ì§€",
  "ê²°í˜¼ì‹ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ 3ê°€ì§€",
  "ë³‘ì›ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒ 3ê°€ì§€",
  "ìº í•‘ì— í•„ìš”í•œ ê²ƒ 3ê°€ì§€",
  "í•œêµ­ ëª…ì ˆ ìŒì‹ 3ê°€ì§€",
  "ìë™ì°¨ ë¸Œëœë“œ 3ê°€ì§€",
  "ì†ê°€ë½ë³´ë‹¤ ì‘ì€ ê²ƒ 3ê°€ì§€",
  "í•˜ëŠ˜ì„ ë‚˜ëŠ” ê²ƒ 3ê°€ì§€",
  "ë§¤ìš´ ìŒì‹ 3ê°€ì§€",
  "ì•± ì´ë¦„ 3ê°€ì§€",
  "ì—­ì‚¬ ì† ì¸ë¬¼ 3ê°€ì§€",
  "ì„¬ ì´ë¦„ 3ê°€ì§€",
  "ê½ƒ ì´ë¦„ 3ê°€ì§€",
  "í•œêµ­ ì‚° ì´ë¦„ 3ê°€ì§€",
  "SNS í”Œë«í¼ 3ê°€ì§€",
  "ìš”ë¦¬í•  ë•Œ í•„ìš”í•œ ë„êµ¬ 3ê°€ì§€",
  "ìš•ì‹¤ì— ìˆëŠ” ê²ƒ 3ê°€ì§€",
  "ê²¨ìš¸ ì˜· 3ê°€ì§€",
  "ì‚¼ê²¹ì‚´ê³¼ í•¨ê»˜ ë¨¹ëŠ” ê²ƒ 3ê°€ì§€",
  "ì£¼ë§ì— í•˜ëŠ” í™œë™ 3ê°€ì§€",
  "ê²Œì„ ì¥ë¥´ 3ê°€ì§€",
  "ë‹­ìœ¼ë¡œ ë§Œë“  ìŒì‹ 3ê°€ì§€",
  "ë™ë¬¼ì›ì— ìˆëŠ” ë™ë¬¼ 3ê°€ì§€",
  "ìš°ìœ ë¡œ ë§Œë“  ê²ƒ 3ê°€ì§€",
  "ìŒ€ë¡œ ë§Œë“  ìŒì‹ 3ê°€ì§€",
  "ì†Œë¦¬ê°€ í° ê²ƒ 3ê°€ì§€",
  "ëŠë¦° ê²ƒ 3ê°€ì§€",
  "ë¹ ë¥¸ ê²ƒ 3ê°€ì§€",
  "ë¬´ê±°ìš´ ê²ƒ 3ê°€ì§€",
  "ê°€ë²¼ìš´ ê²ƒ 3ê°€ì§€",
  "í•™ìš©í’ˆ 3ê°€ì§€",
  "ì„¸ê³„ ìœ ëª… ê´€ê´‘ì§€ 3ê°€ì§€",
  "í•œêµ­ ê´€ê´‘ì§€ 3ê°€ì§€",
  "ë°€ê°€ë£¨ë¡œ ë§Œë“  ìŒì‹ 3ê°€ì§€",
  "ì´ˆë¡ìƒ‰ì¸ ê²ƒ 3ê°€ì§€",
  "ì¤„ë¬´ëŠ¬ê°€ ìˆëŠ” ê²ƒ 3ê°€ì§€",
  "ëœ¨ê±°ìš´ ìŒë£Œ 3ê°€ì§€",
  "ì°¨ê°€ìš´ ë””ì €íŠ¸ 3ê°€ì§€",
  "í•œêµ­ ì˜ˆëŠ¥ í”„ë¡œê·¸ë¨ 3ê°€ì§€",
  "ì˜ì–´ ë‹¨ì–´ 3ê°€ì§€",
  "3ê¸€ì ì´ë¦„ 3ê°€ì§€",
  "ê°ì • í‘œí˜„ 3ê°€ì§€",
];

// ===== ê²Œì„ ìƒíƒœ =====
const PLAYER_COLORS = [
  '#667eea','#38ef7d','#f7971e','#eb3349',
  '#00b4db','#f953c6','#11998e','#fc4a1a'
];

let players = [];
let currentPlayerIndex = 0;
let targetScore = 5;
let usedQuestions = [];
let currentQuestion = '';
let timerInterval = null;
let timeLeft = 5;
let cardRevealed = false;

// ===== ì˜¤ë””ì˜¤ (Web Audio API) =====
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playBeep(freq, duration, type = 'sine') {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type;
  osc.frequency.value = freq;
  gain.gain.value = 0.15;
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

function playTick() { playBeep(800, 0.08); }
function playTimeout() {
  playBeep(200, 0.3, 'sawtooth');
  setTimeout(() => playBeep(150, 0.5, 'sawtooth'), 300);
}
function playSuccess() {
  playBeep(523, 0.15); setTimeout(() => playBeep(659, 0.15), 150);
  setTimeout(() => playBeep(784, 0.3), 300);
}
function playFail() {
  playBeep(300, 0.2, 'square'); setTimeout(() => playBeep(200, 0.4, 'square'), 200);
}
function playWin() {
  [523,659,784,1047].forEach((f, i) => setTimeout(() => playBeep(f, 0.3), i * 200));
}

// ===== DOM ìš”ì†Œ =====
const setupScreen = document.getElementById('setup-screen');
const gameScreen = document.getElementById('game-screen');
const winnerScreen = document.getElementById('winner-screen');
const playerNameInput = document.getElementById('player-name-input');
const addPlayerBtn = document.getElementById('add-player-btn');
const playerListEl = document.getElementById('player-list');
const startBtn = document.getElementById('start-btn');
const targetScoreInput = document.getElementById('target-score');
const turnInfo = document.getElementById('turn-info');
const currentPlayerNameEl = document.getElementById('current-player-name');
const questionCard = document.getElementById('question-card');
const cardBack = document.getElementById('card-back');
const cardFront = document.getElementById('card-front');
const questionText = document.getElementById('question-text');
const timerSection = document.getElementById('timer-section');
const timerCircle = document.getElementById('timer-circle');
const timerProgress = document.getElementById('timer-progress');
const timerText = document.getElementById('timer-text');
const judgeSection = document.getElementById('judge-section');
const judgeSuccess = document.getElementById('judge-success');
const judgeFail = document.getElementById('judge-fail');
const scoreList = document.getElementById('score-list');
const winnerName = document.getElementById('winner-name');
const restartBtn = document.getElementById('restart-btn');
const timeoutOverlay = document.getElementById('timeout-overlay');
const timeoutOkBtn = document.getElementById('timeout-ok-btn');

// ===== ì‹œì‘ í™”ë©´ ë¡œì§ =====
function addPlayer() {
  const name = playerNameInput.value.trim();
  if (!name) return;
  if (players.length >= 8) return alert('ìµœëŒ€ 8ëª…ê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
  if (players.find(p => p.name === name)) return alert('ì´ë¯¸ ìˆëŠ” ì´ë¦„ì…ë‹ˆë‹¤.');
  players.push({ name, score: 0, color: PLAYER_COLORS[players.length % PLAYER_COLORS.length] });
  playerNameInput.value = '';
  playerNameInput.focus();
  renderPlayerList();
}

function removePlayer(index) {
  players.splice(index, 1);
  // ìƒ‰ìƒ ì¬ë°°ì •
  players.forEach((p, i) => p.color = PLAYER_COLORS[i % PLAYER_COLORS.length]);
  renderPlayerList();
}

function renderPlayerList() {
  playerListEl.innerHTML = players.map((p, i) => `
    <li>
      <span><span class="player-color" style="background:${p.color}"></span>${p.name}</span>
      <button onclick="removePlayer(${i})">âœ•</button>
    </li>
  `).join('');
  startBtn.disabled = players.length < 2;
  startBtn.textContent = players.length < 2 ? 'ê²Œì„ ì‹œì‘ (ìµœì†Œ 2ëª…)' : `ê²Œì„ ì‹œì‘ (${players.length}ëª…)`;
}

addPlayerBtn.addEventListener('click', addPlayer);
playerNameInput.addEventListener('keydown', e => { if (e.key === 'Enter') addPlayer(); });

startBtn.addEventListener('click', () => {
  targetScore = parseInt(targetScoreInput.value) || 5;
  players.forEach(p => p.score = 0);
  currentPlayerIndex = 0;
  usedQuestions = [];
  showScreen(gameScreen);
  startTurn();
});

// ===== í™”ë©´ ì „í™˜ =====
function showScreen(screen) {
  [setupScreen, gameScreen, winnerScreen].forEach(s => s.classList.remove('active'));
  screen.classList.add('active');
}

// ===== ì§ˆë¬¸ ë½‘ê¸° =====
function getRandomQuestion() {
  if (usedQuestions.length >= QUESTIONS.length) usedQuestions = [];
  let q;
  do {
    q = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
  } while (usedQuestions.includes(q));
  usedQuestions.push(q);
  return q;
}

// ===== í„´ ì‹œì‘ =====
function startTurn() {
  // ì¹´ë“œ ë¦¬ì…‹
  cardRevealed = false;
  cardBack.style.display = '';
  cardFront.style.display = 'none';
  questionCard.style.background = 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)';

  // íƒ€ì´ë¨¸ ë¦¬ì…‹
  resetTimer();
  timerSection.style.display = '';
  judgeSection.style.display = 'none';

  // í˜„ì¬ í”Œë ˆì´ì–´
  const player = players[currentPlayerIndex];
  turnInfo.textContent = `ë¼ìš´ë“œ ì§„í–‰ ì¤‘`;
  currentPlayerNameEl.textContent = player.name;
  currentPlayerNameEl.style.color = player.color;

  // í•­ìƒ ìƒˆ ì§ˆë¬¸
  currentQuestion = getRandomQuestion();
  questionText.textContent = currentQuestion;

  renderScoreboard();
}

// ===== íƒ€ì´ë¨¸ =====
const CIRCUMFERENCE = 2 * Math.PI * 80; // ~502

function resetTimer() {
  clearInterval(timerInterval);
  timeLeft = 5;
  timerText.textContent = '5';
  timerProgress.style.strokeDasharray = CIRCUMFERENCE;
  timerProgress.style.strokeDashoffset = '0';
  timerCircle.className = 'timer-circle';
}

function startTimer() {
  audioCtx.resume();

  let elapsed = 0;
  const totalMs = 5000;
  const intervalMs = 50;

  timerInterval = setInterval(() => {
    elapsed += intervalMs;
    const remaining = Math.max(0, totalMs - elapsed);
    const seconds = Math.ceil(remaining / 1000);
    const fraction = remaining / totalMs;

    timerText.textContent = seconds;
    timerProgress.style.strokeDashoffset = CIRCUMFERENCE * (1 - fraction);

    // ìƒ‰ìƒ ë³€ê²½
    if (fraction <= 0.3) {
      timerCircle.className = 'timer-circle danger';
    } else if (fraction <= 0.6) {
      timerCircle.className = 'timer-circle warning';
    }

    // ë§¤ì´ˆ í‹± ì‚¬ìš´ë“œ
    if (elapsed % 1000 < intervalMs && seconds > 0 && seconds <= 4) {
      playTick();
    }

    if (remaining <= 0) {
      clearInterval(timerInterval);
      timerText.textContent = '0';
      timerProgress.style.strokeDashoffset = CIRCUMFERENCE;
      onTimeout();
    }
  }, intervalMs);
}

// ===== ì¹´ë“œ í„°ì¹˜ â†’ ì¦‰ì‹œ íƒ€ì´ë¨¸ ì‹œì‘ =====
questionCard.addEventListener('click', () => {
  if (cardRevealed) return;
  cardRevealed = true;
  cardBack.style.display = 'none';
  cardFront.style.display = '';
  questionCard.style.background = 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)';
  playBeep(600, 0.1);
  startTimer();
});

function onTimeout() {
  playTimeout();
  timeoutOverlay.classList.add('show');
}

timeoutOkBtn.addEventListener('click', () => {
  timeoutOverlay.classList.remove('show');
  showJudge();
});

function showJudge() {
  timerSection.style.display = 'none';
  judgeSection.style.display = '';
}

// ===== íŒì • =====
judgeSuccess.addEventListener('click', () => {
  playSuccess();
  const player = players[currentPlayerIndex];
  player.score += 1;

  if (player.score >= targetScore) {
    showWinner(player);
    return;
  }

  currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
  startTurn();
});

judgeFail.addEventListener('click', () => {
  playFail();
  currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
  startTurn();
});

// ===== ì ìˆ˜íŒ =====
function renderScoreboard() {
  scoreList.innerHTML = players.map((p, i) => `
    <div class="score-item ${i === currentPlayerIndex ? 'current' : ''}">
      <div class="score-name" style="color:${p.color}">${p.name}</div>
      <div class="score-value">${p.score}</div>
    </div>
  `).join('');
}

// ===== ìŠ¹ë¦¬ =====
function showWinner(player) {
  showScreen(winnerScreen);
  winnerName.textContent = player.name;
  winnerName.style.color = player.color;
  playWin();
  spawnConfetti();
}

function spawnConfetti() {
  const container = document.getElementById('confetti-container');
  container.innerHTML = '';
  const colors = ['#667eea','#38ef7d','#f7971e','#eb3349','#ffd200','#f953c6','#00b4db'];
  for (let i = 0; i < 80; i++) {
    const el = document.createElement('div');
    el.className = 'confetti';
    el.style.left = Math.random() * 100 + '%';
    el.style.background = colors[Math.floor(Math.random() * colors.length)];
    el.style.width = (Math.random() * 10 + 5) + 'px';
    el.style.height = (Math.random() * 10 + 5) + 'px';
    el.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    el.style.animationDuration = (Math.random() * 2 + 1.5) + 's';
    el.style.animationDelay = (Math.random() * 2) + 's';
    container.appendChild(el);
  }
  setTimeout(() => container.innerHTML = '', 5000);
}

// ===== ë‹¤ì‹œ í•˜ê¸° =====
restartBtn.addEventListener('click', () => {
  players.forEach(p => p.score = 0);
  currentPlayerIndex = 0;
  usedQuestions = [];
  showScreen(setupScreen);
  renderPlayerList();
});
</script>
</body>
</html>
